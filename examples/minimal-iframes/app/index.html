<!doctype html>
<html>
  <body>
    <div id="root"></div>

    <iframe id="remote-iframe" src="/remote.html" hidden></iframe>

    <script type="module">
      class UIBanner extends HTMLElement {
        static get observedAttributes() {
          return ['tone'];
        }

        connectedCallback() {
          // We will allow you to pass a `tone` attribute to the element, which
          // styles the banner according to our design system. We’ll see how to
          // use this in the remote environment in the next step.
          const tone = this.getAttribute('tone') ?? this.tone ?? 'neutral';

          const root = this.attachShadow({mode: 'open'});

          // We render a <slot> where we want the element’s children to go.
          root.innerHTML = `
            <style>
              .Banner {
                padding: 1rem;
                border-radius: 0.4rem;
                background-color: lightgray;
                border: 1px solid gray;
              }

              .Banner--warning {
                background-color: #fff6de;
                border-color: #f5dab1;
              }
            </style>
            <div class="Banner Banner--${tone}"><slot></slot></div>
          `;
        }

        attributeChangedCallback(name, oldValue, newValue) {
          if (name === 'tone') {
            const banner = this.shadowRoot?.querySelector('.Banner');
            if (banner == null) return;

            banner.classList.remove(`Banner--${oldValue ?? 'neutral'}`);
            banner.classList.add(`Banner--${newValue ?? 'neutral'}`);
          }
        }
      }

      customElements.define('ui-banner', UIBanner);
    </script>

    <script type="module">
      import {DOMRemoteReceiver} from '@remote-dom/core/receiver';

      const root = document.querySelector('#root');
      const iframe = document.querySelector('#remote-iframe');

      // In earlier examples, we did not pass any arguments, which allows the DOM
      // receiver to mirror any element it receives. By passing the `elements` option,
      // we are restricting the allowed elements to only the ones we list, which in this
      // case means only our `ui-banner` element can be rendered.
      const receiver = new DOMRemoteReceiver({
        elements: ['ui-banner'],
      });
      receiver.connect(root);

      window.addEventListener('message', ({source, data}) => {
        if (source !== iframe.contentWindow) return;
        receiver.connection.mutate(data);
      });
    </script>
  </body>
</html>
